#ifndef DEMODULATION_H_
#define DEMODULATION_H_

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

#include "filter.h"

/*

 FIR filter(s) designed with
 http://t-filter.appspot.com

The impulse response for the 2400 Hz bandpass filter 

sampling frequency: 44100 Hz

* 0 Hz - 1400 Hz
  gain = 0
  desired attenuation = -40 dB
  actual attenuation = -40.279851620350804 dB

* 2200 Hz - 2600 Hz
  gain = 1
  desired ripple = 5 dB
  actual ripple = 3.018116774336033 dB

* 3800 Hz - 22000 Hz
  gain = 0
  desired attenuation = -40 dB
  actual attenuation = -40.279851620350804 dB

*/
static double markImpulse[] = {
  0.006432308547904103,
  0.0031955465476082305,
  0.002759401874045974,
  0.0012198765631986747,
  -0.0014157517736883834,
  -0.004931371456289126,
  -0.008799430389881244,
  -0.012302696144607078,
  -0.014561248198493564,
  -0.014807608423269569,
  -0.012418958535540918,
  -0.007257218225110027,
  0.000383175664461854,
  0.009591534202420902,
  0.0190580671426726,
  0.027134468957596792,
  0.032215755460782425,
  0.032931019086490876,
  0.028554196500322666,
  0.019089025168783053,
  0.005492287010580127,
  -0.010533589389274975,
  -0.026630177130691005,
  -0.04026986231571457,
  -0.04905556090715388,
  -0.05126585524294996,
  -0.046077059912309606,
  -0.03387880224239009,
  -0.01614962427488107,
  0.004613204463667964,
  0.025401465209944237,
  0.043049024368534645,
  0.054878993827067166,
  0.059027983958958676,
  0.054878993827067166,
  0.043049024368534645,
  0.025401465209944237,
  0.004613204463667964,
  -0.01614962427488107,
  -0.03387880224239009,
  -0.046077059912309606,
  -0.05126585524294996,
  -0.04905556090715388,
  -0.04026986231571457,
  -0.026630177130691005,
  -0.010533589389274975,
  0.005492287010580127,
  0.019089025168783053,
  0.028554196500322666,
  0.032931019086490876,
  0.032215755460782425,
  0.027134468957596792,
  0.0190580671426726,
  0.009591534202420902,
  0.000383175664461854,
  -0.007257218225110027,
  -0.012418958535540918,
  -0.014807608423269569,
  -0.014561248198493564,
  -0.012302696144607078,
  -0.008799430389881244,
  -0.004931371456289126,
  -0.0014157517736883834,
  0.0012198765631986747,
  0.002759401874045974,
  0.0031955465476082305,
  0.006432308547904103
};

/*

The impulse response for the 1200 Hz lowpass filter 

* 0 Hz - 1400 Hz
  gain = 1
  desired ripple = 5 dB
  actual ripple = 3.9471600687586816 dB

* 2200 Hz - 22000 Hz
  gain = 0
  desired attenuation = -40 dB
  actual attenuation = -40.47204030910638 dB

*/

static double spaceImpulse[] = {
  -0.0063040372732533125,
  -0.006097220310941929,
  -0.006208508041226065,
  -0.009594520866552853,
  -0.010234239687666553,
  -0.013401536190740604,
  -0.014133620867072212,
  -0.016691601073443908,
  -0.016965588630858106,
  -0.018416988881500677,
  -0.017671110346850583,
  -0.01755294940094256,
  -0.015293988345692164,
  -0.013260957909643373,
  -0.009206816205233071,
  -0.0051460931515313136,
  0.0007045808068395724,
  0.006577865996468717,
  0.013889617246586803,
  0.021047597942938406,
  0.029163493190878947,
  0.0367999229064362,
  0.04483526620531718,
  0.0519744269639494,
  0.05894976173590525,
  0.0646077664156152,
  0.06962620067992067,
  0.07297936695686834,
  0.07537542992462563,
  0.07591127494804607,
  0.07537542992462563,
  0.07297936695686834,
  0.06962620067992067,
  0.0646077664156152,
  0.05894976173590525,
  0.0519744269639494,
  0.04483526620531718,
  0.0367999229064362,
  0.029163493190878947,
  0.021047597942938406,
  0.013889617246586803,
  0.006577865996468717,
  0.0007045808068395724,
  -0.0051460931515313136,
  -0.009206816205233071,
  -0.013260957909643373,
  -0.015293988345692164,
  -0.01755294940094256,
  -0.017671110346850583,
  -0.018416988881500677,
  -0.016965588630858106,
  -0.016691601073443908,
  -0.014133620867072212,
  -0.013401536190740604,
  -0.010234239687666553,
  -0.009594520866552853,
  -0.006208508041226065,
  -0.006097220310941929,
  -0.0063040372732533125
};

/*
The impulse response for the lowpass filter used in envelope detection

sampling frequency: 44100 Hz

* 0 Hz - 400 Hz
  gain = 1
  desired ripple = 5 dB
  actual ripple = 3.5838971574734133 dB

* 1000 Hz - 22000 Hz
  gain = 0
  desired attenuation = -40 dB
  actual attenuation = -41.28494277165867 dB

*/

static double envelopeImpulse[] = {
  -0.004533946289383208,
  -0.00041899722204182427,
  -0.00041815672796951495,
  -0.0003722603226234853,
  -0.0003222656882548766,
  -0.00022276691994435434,
  -0.0001149688100840453,
  0.00004654894810613058,
  0.00022077348944136386,
  0.0004530166942184525,
  0.0007016637169465987,
  0.0010119615886867222,
  0.0013420467516075962,
  0.001736445954018798,
  0.0021531259353924385,
  0.0026354753856574127,
  0.0031413835249814617,
  0.0037120490737017242,
  0.00431189388348323,
  0.004964901611611426,
  0.00564639925741374,
  0.0063942175727933525,
  0.0071543147750586485,
  0.007973783787424823,
  0.008803104643107386,
  0.009687425954318664,
  0.010576001395652242,
  0.011511885091674489,
  0.012444356131184811,
  0.013414842367689766,
  0.014371804248486554,
  0.015357113249899204,
  0.016318546027259698,
  0.017297800470069034,
  0.018242476494872043,
  0.019194318920555196,
  0.020099655375611623,
  0.021002715601645613,
  0.02184834450022583,
  0.02267769703776246,
  0.023442282180813286,
  0.02418034347211845,
  0.02484173216721484,
  0.025467222241487838,
  0.026008011970293538,
  0.026505912317317065,
  0.026911253588414858,
  0.027267635601660196,
  0.02752750018763283,
  0.027733138173417528,
  0.027839305823120723,
  0.027889629603397203,
  0.027839305823120723,
  0.027733138173417528,
  0.02752750018763283,
  0.027267635601660196,
  0.026911253588414858,
  0.026505912317317065,
  0.026008011970293538,
  0.025467222241487838,
  0.02484173216721484,
  0.02418034347211845,
  0.023442282180813286,
  0.02267769703776246,
  0.02184834450022583,
  0.021002715601645613,
  0.020099655375611623,
  0.019194318920555196,
  0.018242476494872043,
  0.017297800470069034,
  0.016318546027259698,
  0.015357113249899204,
  0.014371804248486554,
  0.013414842367689766,
  0.012444356131184811,
  0.011511885091674489,
  0.010576001395652242,
  0.009687425954318664,
  0.008803104643107386,
  0.007973783787424823,
  0.0071543147750586485,
  0.0063942175727933525,
  0.00564639925741374,
  0.004964901611611426,
  0.00431189388348323,
  0.0037120490737017242,
  0.0031413835249814617,
  0.0026354753856574127,
  0.0021531259353924385,
  0.001736445954018798,
  0.0013420467516075962,
  0.0010119615886867222,
  0.0007016637169465987,
  0.0004530166942184525,
  0.00022077348944136386,
  0.00004654894810613058,
  -0.0001149688100840453,
  -0.00022276691994435434,
  -0.0003222656882548766,
  -0.0003722603226234853,
  -0.00041815672796951495,
  -0.00041899722204182427,
  -0.004533946289383208
};

int demodulate(char inputFile[],char outputFile[],bool plot); 

#endif